---
title: "FAST FOOD; MC DONALD"
author: "Alba Estela Garcia(alesgar3@alumni.uv.es)  \n\n Melanie Neufcour(meneuf@alumni.uv.es)  \n \n Mireia Yang√ºez(miyano@alumni.uv.es). \n\n Universitat de Val√®ncia"
date: "Diciembre de 2021 (actualizado el `r format(Sys.time(), '%d-%m-%Y')`)"
output:
  html_document:
    #css: "./assets/my_css_file.css"
    theme: paper
    highlight: textmate 
    toc: true
    toc_depth: 3 
    toc_float: 
      collapsed: true
      smooth_scroll: true
    self_contained: true
    number_sections: false
    df_print: kable
    code_download: true
editor_options: 
  chunk_output_type: console
---

```{r packages-setup, include = FALSE}
library(tidyverse)
library(klippy)  
remotes::install_github("rlesur/klippy")
library(knitr)
```

```{r chunk-setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE, 
                      #results = "hold",
                      cache = FALSE, cache.path = "/caches/", comment = "#>",
                      #fig.width = 7, #fig.height= 7,   
                      #out.width = 7, out.height = 7,
                      collapse = TRUE,  fig.show = "hold",
                      fig.asp = 0.628, out.width = "75%", fig.align = "center")
knitr::opts_chunk$set(dev = "png", dev.args = list(type = "cairo-png"))
```

```{r options-setup, include = FALSE}
options(scipen = 999) #- para quitar la notaci√≥n cient√≠fica
options("yaml.eval.expr" = TRUE) 
```


```{r klippy, echo = FALSE}
klippy::klippy(position = c("top", "right")) #- remotes::install_github("rlesur/klippy")
```



<hr class="linea-black">

<!-- El p√°rrafo de abajo has de dejarlo casi igual, solo HAS de SUSTITUIR "perezp44" por tu usuario de Github-->
Trabajo elaborado para la asignatura "Programaci√≥n y manejo de datos en la era del Big Data" de la Universitat de Val√®ncia durante el curso 2021-2022. El repo del trabajo est√° [aqu√≠](https://github.com/meneuf/trabajo_BigData_equipo){target="_blank"}. 

<!-- El p√°rrafo de abajo has de dejarlo exactamente igual, NO has de cambiar nada-->

La p√°gina web de la asignatura y los trabajos de mis compa√±eros pueden verse [aqu√≠](https://perezp44.github.io/intro-ds-21-22-web/07-trabajos.html){target="_blank"}.

<hr class="linea-red">


# [1. Introducci√≥n]{.verdecito}

En el presente trabajo vamos a mostrar algunos datos de inter√©s de una de las empresas multinacionales m√°s conocidas a nivel mundial, McDonald's. Por un lado, veremos el men√∫ de esta franquicia, as√≠ como los macronutrientes que contienen los productos y los valores nutricionales, mostrando y explicando los aspectos m√°s relevantes. Tambi√©n trataremos de compararlo con otros grandes restaurantes de comida r√°pida en los Estados Unidos, pa√≠s que acoge m√°s cantidad de marcas de restaurantes de comida r√°pida en el mundo por excelencia.

# 1.1 Breve Historia

El primer restaurante de McDonald's se ubicaba en California, en el a√±o 1948, como un bar de carretera. Fueron los dos hermanos Maurice y Richard Mcdonald quien llevaron a cabo este proyecto. Los elementos que lo caracterizaban y fueron motivo del √©xito eran; por un lado, se pod√≠a pedir y recoger los productos desde el coche, los grandes ventanales que ten√≠an permit√≠an ver desde fuera como el pedido se preparaba y por √∫ltimo, los bajos precios que lo diferenciaban de competidores. Este √∫ltimo estuvo a punto de llevar a los hermanos a la quiebra, por lo que estos tuvieron que cerrar el negocio y organizar una buena estrategia. Resumiendo, Ray A. Kroc, alguien importante en los negocios por aquella zona, vio el potencial del restaurante en si y con la cesi√≥n del derecho de comercializar la marca por parte de los hermanos, abri√≥ otro restaurante en Illinois. Y as√≠ se podr√≠a decir que empez√≥ este negocio que actualmente tiene tanto √©xito.


La introducci√≥n **es una de las partes importantes del trabajo**. En la introducci√≥n suele ponerse el objetivo, motivaci√≥n, un peque√±o resumen del trabajo y avance de conclusiones si es que hay.

```{r, eval = TRUE}
2 + 2
```

Yo no usar√≠a CSS, bastante trabajo ten√©is, pero ... si usas CSS para tunear tu html podr√°s dejarlo m√°s bonito, o al menos m√°s a tu gusto. Por ejemplo, podr√°s f√°cilmente cambiar el tama√±o de algunas palabras, por ejemplo, **[unas palabras en grande y en negrita]{.large}**, aunque si estas usando CSS saldr√°n en verde porque en el CSS he puesto que la negrita salga en verde. Por ejemplo, podr√°s poner f√°cilmente [unas palabras en purple]{.purple}, y ahora, [[en grande y en rojito]{.rojito}]{.large}.

# 2. Datos

Este trabajo ha sido posible realizarlo con la ayuda de varias fuentes de donde hemos sacado los datos. En la p√°gina web facilitada por la asignatura (kaggle), hemos utilziado principalmente 5 datasests, que los indicaremos en la √∫ltima parte, en la bibliograf√≠a. Por otro lado, hemos accedido a documentos oficiales del restaurante para obtener m√°s datos.


Una parte **importante** del trabajo es explicar **de donde proceden los datos** y cual ha sido el proceso de limpieza

```{r, eval = TRUE}
ggplot(iris, aes(Sepal.Length, Petal.Length)) + geom_point()


```





## 2.1. Procesando los datos



Pues eso que ten√©is que contar (un poco) el procesado de datos

```{r, eval = TRUE}
library(ggplot2)









menu <- rio::import("./datos/menu.csv")
restaurantesUS <- rio::import("./datos/FastFoodRestaurants.csv")
fastfoodrestaurants <- rio::import("./datos/fastfoodrestaurants.csv")
ruta4 <- here::here("datos", "Datafiniti_Fast_Food_Restaurants_May19.csv")
fastfoodrestaurants19 <- rio::import(ruta4)


mas_restaurantes <- restaurantesUS %>% 
  group_by(name) %>% 
  mutate(n_restaurantes = sum(NN = n())) %>%
  distinct(name, n_restaurantes) %>%
  arrange(desc(n_restaurantes)) %>%
  filter(n_restaurantes >=192) 

  gg_restaurantes <- ggplot(mas_restaurantes, aes(name, n_restaurantes)) +
  geom_bar(stat = "identity")
  
gg_restaurantes

```

```
library(dplyr)
df_menu <- menu %>%
select(Item) %>%

#Productos que ofrece MacDonald¬¥s

library(reactable)
reactable(df_menu, defaultPageSize =  8,  paginationType = "jump", showPageSizeOptions =  TRUE , pageSizeOptions =  c ( 10 , 50 , 100, 150, 200, 260 ),defaultColDef = colDef(
    align = "center",
    minWidth = 70,
    headerStyle = list(background = "red"),
    filterable = TRUE),  highlight = TRUE, outlined = TRUE,
    columns = list(
  `Item` = colDef(style = function(value) {
    if (value > 0) {
      color <- "#F5C710"}
      else {
      color <- "#e000000"
    }
    list(color = color, fontWeight = "bold")
  })))


```
#¬øCu√°l es el producto con m√°s calorias?
df_calorias <- menu %>%
select(Item, Calories) 

dftop1 <- df_calorias %>% 
slice_max(Calories, n=1) #Chicken McNuggets (40 piece) es el producto con m√°s calorias.

Imagen <- "https://i.pinimg.com/originals/d5/5f/03/d55f035c37d84ec55934ba6d469bedce.jpg"

dftop1 <- dftop1 %>% add_column(Imagen)

library(gt)
Tabla_Pmascal <- dftop1 %>% gt()

Tabla_Pmascal <- Tabla_Pmascal %>%
                   tab_header(title = md("**Producto con m√°s calorias**")
                   
Tabla_Pmascal <- Tabla_Pmascal %>%
                tab_options(heading.background.color = "coral") %>% tab_options(heading.title.font.size = 15,  column_labels.font.weight =  "bold")


Tabla_Pmascal <- Tabla_Pmascal  %>%
  gt::text_transform(locations = cells_body(columns = c(Imagen)), fn = function(x) {gt::web_image(x, height = 50)}) %>%  cols_align(
   align = "center")

Tabla_Pmascal


#¬øCu√°l es el producto con menos calorias?
dfmin1 <- df_calorias %>% 
slice_min(Calories, n=1) %>%
filter (Item == "Dasani Water Bottle") #Dasani Water Bottle es uno de los productos con menos calorias 

Imagen <- "https://i.pinimg.com/originals/3c/df/ae/3cdfaeaa504db8aaf100843a12aacc97.png"

dfmin1 <- dfmin1 %>% add_column(Imagen)


Tabla_Pmincal <- dfmin1 %>% gt()

Tabla_Pmincal <- Tabla_Pmincal %>%
                   tab_header(title = md("**Producto con menos calorias**")
                   
Tabla_Pmincal <- Tabla_Pmincal %>%
                tab_options(heading.background.color = "coral") %>% tab_options(heading.title.font.size = 15,  column_labels.font.weight =  "bold")


Tabla_Pmincal <- Tabla_Pmincal  %>%
  gt::text_transform(locations = cells_body(columns = c(Imagen)), fn = function(x) {gt::web_image(x, height = 50)}) %>%  cols_align(
   align = "center")

Tabla_Pmincal




df14prod <- menu %>%
  select(Item, Protein) %>%
  slice_max(Protein, n = 14)%>%
  group_by(Item, Protein) %>%
   summarise(n = n())%>%
  arrange(desc(Protein))%>%
  drop_na()
 
  
  
 





##GR√ÅFICO INTERACTIVO   
  
### Carbohydrates  
```{r echo=FALSE,warning=FALSE}
install.packages("ggplotly")
plot_ly(x = menu$Category, y=menu$Carbohydrates,color = menu$Category,colors =new_col , type = "box") %>% layout(
         xlab = list(title = ""),
         ylab = list(title = ""),
         showlegend=FALSE,
         autosize = T)
```


```{r echo=FALSE,warning=FALSE}

 
p<-plot_ly(x=menu$Calories, y=menu$Carbohydrates, type="scatter", mode = "markers" , 
marker=list( color=ifelse(menu$Calories>500,"red","blue") , opacity=0.5 , size=20) ) 
p

```
    
### Fat  
```{r echo=FALSE,warning=FALSE}
plot_ly(x = menu$Category, y=menu$Total.Fat,color = menu$Category,colors =new_col , type = "box") %>% layout(
         xlab = list(title = ""),
         ylab = list(title = ""),
         showlegend=FALSE,
         autosize = T)

```
Comapring Total Fat & Saturated Fat with Calories from Fat for all items.
```{r echo=FALSE}
m1<-menu%>%select(Total.Fat,Calories.from.Fat,Saturated.Fat)
m2<-as.matrix(m1)
colnames(m2)<-NULL
#m2
p <- plot_ly(z=~m2) %>% add_surface()%>%layout(scene = list(xaxis = list(title = 'Total.Fat'),
                     yaxis = list(title = 'Calories from Fat'),
                     zaxis = list(title = 'Saturated Fat')))
p
```



Comapring different Fats in items(category= Beef & Park, Chicken & Fish) 
```{r echo=FALSE,warning=FALSE}
m1<-menu%>%filter(Category %in% c("Beef & Pork","Chicken & Fish"))%>%arrange(desc(Total.Fat....Daily.Value.,Saturated.Fat....Daily.Value.,Trans.Fat))
p <- plot_ly(m1, x = ~factor(Item,levels=Item), y = ~Total.Fat....Daily.Value., name = 'Total Fat DV', type = 'scatter', mode = 'lines+markers', width = 2,color = I('red')) %>%
    add_trace(y = ~Saturated.Fat....Daily.Value., name = 'Saturated Fat DV',color=I('blue')) %>%
  add_trace(y = ~Trans.Fat, name = 'Trans Fat',color=I("hotpink")) %>%
      layout(title = 'Camparing Fat in Items',
         xaxis = list(title = "",
                      showgrid = FALSE),
         yaxis = list(title = "value",
                      showgrid = FALSE),
         legend=list(orientation="r",xanchor="center"))
p
```


### Sugars  
According to the American Heart Association (AHA), the maximum amount of added sugars you should eat in a day are (7):  
  
Men: 150 calories per day (37.5 grams or 9 teaspoons).  
Women: 100 calories per day (25 grams or 6 teaspoons).  
```{r echo=FALSE,warning=FALSE}
plot_ly(x = menu$Category, y=menu$Sugars,color = menu$Category,colors =new_col , type = "bar") %>% layout(title = "Sugars",
         xaxis = list(title = ""),
         yaxis = list(title = ""),
         showlegend=FALSE,
         autosize = T)
```  
 
 
```{r echo=FALSE,warning=FALSE}
library(stringr)
ss<-menu%>%select(Category,Item,Sugars,Serving.Size,Sugars)%>%filter(Category=="Smoothies & Shakes")
ss$size<-NULL
ss$size[str_detect(ss$Item,"Small")]<-"Small"
ss$size[str_detect(ss$Item,"Medium")]<-"Medium"
ss$size[str_detect(ss$Item,"Large")]<-"Large"
ss$size[str_detect(ss$Item,"Snack")]<-"Snack"
ss%>%filter(!size == "Snack")%>%arrange(desc(Sugars))%>%ggplot(aes(x=factor(Item,level=Item),y=Sugars,group=size,fill=size))+
  geom_bar(stat="identity",position="dodge",alpha=0.7)+theme(axis.text.x = element_text(angle=90))+coord_flip()+
  labs(x="Item",title="Sugar content in Smoothies & Shakes")
```


### Cholestrol  

Comparing Cholesterol and Cholesterol DV in Items.  
```{r echo=FALSE,warning=FALSE}
menu %>% arrange(desc(Cholesterol....Daily.Value.))%>%plot_ly( x = ~factor(Item,levels=Item), y = ~Cholesterol, type="scatter",color=~Item, size=~Cholesterol,colors='Paired',mode = "markers" , marker=list( opacity=0.7) ) %>% 
  add_trace(x = ~factor(Item,levels=Item), y = ~Cholesterol....Daily.Value., modee="lines",  yaxis = "y2", name = "Cholestrol DV",color=I('red'),line=list(opacity=0.7)) %>%
  layout(yaxis2 = list(overlaying = "y", side = "left",title="Cholesterol DV"),
      title = "Cholesterol Content",
         xaxis = list(title = ""),
         yaxis = list(title = "Total Cholestrol",side="right"),
         showlegend=FALSE,autosize = T,margin = list(
      pad = 30, b = 90, l = 60, r = 80
    ))
```
 
 

```{r echo=FALSE,warning=FALSE}
ch<-menu %>% select(Category,Item,Cholesterol)%>% arrange(desc(Cholesterol))%>%head(25)
p1<-plot_ly(ch, x=factor(ch$Item,level=ch$Item),y=ch$Cholesterol,color=ch$Category,type="bar")%>%layout(title="Cholestrol Rich Items",height=400)
ch1<-menu %>% select(Category,Item,Cholesterol)%>% arrange(desc(Cholesterol))%>%filter(Cholesterol >5 & Cholesterol<25)
p2<-plot_ly(ch1, x=factor(ch1$Item,level=ch1$Item),y=ch1$Cholesterol,color=ch1$Category,type="bar")%>%layout(title="Cholestrol Low Items",height=400)
ggplotly(p1)
ggplotly(p2)
```
  
  
##LO BUENO DEL MAC

```{r}
ggplot(subset(menu,Category=="Salads"), aes(reorder(Item,Calories),Calories,fill=Calories)) + geom_bar(stat = "identity")  + theme(legend.position = "none")+ggtitle("Salads Menu Vs Calories") + xlab("Item") + ylab("Calories")  + coord_flip()

#Poner que alimentos tienen mas vitamina y proteina y veremos que son las ensaldas, entonces si quieres comer algo sano en mac tu mejor opci√≥n es eso
```

 




# 3. Trabajos en los que te has basado

Es importante que, si hab√©is utilizado, os hab√©is basado/ayudado, de alg√∫n an√°lisis previo de otro autor, lo dig√°is claramente.

Por ejemplo, est√° cita es de NV

> "Nadie llega tan lejos si no es para seguir"




# 4. RECUERDA!!!


<div class = "caja-medium-aquamarine">
Recuerda que el capitan del equipo **tiene que mandarme un mail** con su nombre, usuario de Github, nombre del trabajo en equipo y el nombre de sus compa√±eros de equipo.
</div>

<br>

<div class = "caja-crimson">
Recuerda que el repo de Github **se ha de llamar EXACTAMENTE** "trabajo_BigData_equipo"  
</div>

<br>

<div class = "caja-darkkhaki">
Por favor, **no cambies el primer p√°rrafo**. Sirve para dar contexto al trabajo y remitir a los potenciales lectores a la web del curso y poder ver los otros trabajos. Bueno, si que has de cambiar algo: **has de sutituir "perezp44" por tu usuario de Github**, tanto en el archivo index.Rmd como en el Readme.Rmd
</div>


<br>

<div class = "caja-linea-verde">
Recuerda , la fecha l√≠mite para la entrega es el 15 de diciembre, 2 d√≠as antes de la exposici√≥n de los trabsjos
</div>


<br>

<hr class="linea-red">


<div class = "caja-gris-gainboro">
SUERTE!!!!  üßô‚Äç‚ôÄÔ∏èüßô‚Äç‚ôÄÔ∏è
</div>




# 4. Bibliograf√≠a

No tienen porque ser art√≠culos o libros; pueden ser posts, repos de Github, paquetes etc ...

<br><br>

<hr class="linea-red">
<hr class="linea-red">


```{r, echo = FALSE}
sessioninfo::session_info() %>% details::details(summary = 'Informaci√≥n de mi R-sesi√≥n:') 
```


<br><br>

<div class="tocify-extend-page" data-unique="tocify-extend-page" style="height: 0;"></div>
